{"name":"Bencode","tagline":"BitTorrent encoding implementation for Clojure.","body":"# bencode\r\n\r\nClojure implementation of [Bencode](http://bittorrent.org/beps/bep_0003.html#bencoding),\r\nthe encoding used by BitTorrent for storing and transmitting loosely structured data.\r\n\r\n## Features\r\n\r\n* Parsing bencode strings directly to Clojure data structures and vice-versa\r\n* Support for input and output streams\r\n* Read and write BitTorrent metainfo (.torrent) files\r\n* Can generate Magnet link from BitTorrent metainfo\r\n* Multi-threaded algorithm for fast piece hashing\r\n\r\n\r\n## Installation\r\n\r\nAdd the following dependency to your _project.clj_ file:\r\n\r\n````clojure\r\n\r\n[bencode \"0.2.5\"]\r\n````\r\n\r\n\r\n## Usage\r\n\r\n### Encoding and Decoding\r\n\r\nFirst, import the `bencode.core` namespace:\r\n\r\n````clojure\r\n\r\n(use '[bencode.core])\r\n````\r\n\r\nAt this point, you should be able to use `bencode` and `bdecode` functions for\r\nencoding and decoding, respectively:\r\n\r\n````clojure\r\n\r\n(bencode {:cow \"moo\" :spam [\"info\" 32]})\r\n;; -> \"d3:cow3:moo4:spaml4:infoi32eee\"\r\n\r\n(bdecode \"d3:cow3:moo4:spaml4:infoi32eee\")\r\n;; -> {:cow \"moo\", :spam [\"info\" 32]}\r\n```\r\n\r\n\r\n##### Supported Data Types\r\n\r\nAccording to the Bencoding spec, only _strings_, _integers_, _lists_ and\r\n_dictionaries_ should be supported. Furthermore, only strings can be used as\r\nkeys in a dictionary, and the keys must appear in sorted order (sorted as raw\r\nstrings, not alphanumerics).\r\n\r\nOn the Clojure side, _keywords_ are encoded as _strings_, _sets_ and _vectors_\r\nare encoded as _lists_, and all integers - _byte_, _short_, _int_, _long_,\r\n_big integers_ - are encoded as _integers_ with arbitrary size, and decoded to\r\nthe smallest type which can hold the number without losing data.\r\n\r\n\r\n#### Encoding Options\r\n\r\nThe `bencode` function also accepts an optional map:\r\n\r\n````clojure\r\n\r\n(bencode \"moo\" {:raw-str? true})\r\n;; -> #<byte[] [B@53c059f6>\r\n````\r\n\r\nThese are the supported encoding options:\r\n\r\n* `:to` - Instance of `OutputStream` where the encoding result should be\r\n  written to. Default: `nil`\r\n* `:raw-str?` - Whether the string being encoded should be returned as a\r\n  byte array. This option can only be used if the option `:to` is absent.\r\n  Default: `false`\r\n\r\n\r\n#### Decoding Options\r\n\r\nThe `bdecode` function also accepts an optional map:\r\n\r\n````clojure\r\n\r\n(bdecode \"d3:cow3:moo4:spaml4:infoi32eee\", {:str-keys? true :raw-keys [\"spam\"]})\r\n;; -> {\"cow\" \"moo\", \"spam\" [#<byte[] [B@74184b3b> 32]}\r\n````\r\n\r\nThe input might be either a _string_, a _byte array_ or an _input stream_.\r\n\r\nThese are the supported decoding options:\r\n\r\n* `:str-keys?` - Whether strings should be used as dictionary keys instead of\r\n  keywords. Default: `false`\r\n* `:raw-keys` - List containing all dictionary keys whose values should be\r\n  decoded as raw strings instead of UTF-8-encoded strings. Default: `nil`\r\n\r\n\r\n### BitTorrent Metainfo\r\n\r\n#### Reading Metainfo Files\r\n\r\nA collection of useful functions for BitTorrent metainfo parsing are available\r\nunder the `bencode.metainfo.reader` namespace:\r\n\r\n````clojure\r\n\r\n(use '[bencode.metainfo.reader])\r\n\r\n;; parsing an input stream\r\n(def metainfo (parse-metainfo input-stream))\r\n\r\n;; parsing a file given its path\r\n(def metainfo (parse-metainfo-file \"/file/path\"))\r\n````\r\n\r\nTo extract bits of information from this metainfo:\r\n\r\n````clojure\r\n\r\n(torrent-name metainfo)\r\n;; -> \"my.supercool.torrent\"\r\n\r\n(public-torrent? metainfo)\r\n;; -> true\r\n\r\n(torrent-info-hash-str metainfo)\r\n;; -> \"b174c9c090275f858853ba5ea1b01762eaa59f9d\"\r\n````\r\n\r\nIt's also possible to generate the Magnet link for a metainfo:\r\n\r\n````clojure\r\n\r\n(torrent-magnet-link metainfo)\r\n;; -> \"magnet:?xt=urn:btih:...\"\r\n````\r\n\r\nPlease check out the source code for a complete list of the available functions.\r\n\r\n#### Creating a Metainfo Dictionary\r\n\r\nIt's very easy to create a metainfo file:\r\n\r\n````clojure\r\n\r\n(use '[bencode.metainfo.writer])\r\n\r\n(def metainfo (create-metainfo :file               file-obj\r\n                               :created-by         \"You\"\r\n                               :announce-list      [[\"tracker-1\"] [\"tracker-2\"]]\r\n                               :private?           false\r\n                               :name               \"optional.torrent.name\"\r\n                               :piece-length-power 7 ;; piece length = 2^7KiB\r\n                               :n-threads          4 ;; for fast parallel piece hashing\r\n                               :comment            \"Some torrent\"))\r\n````\r\n\r\nThis operation might take several minutes depending on the file size.\r\n\r\nTo be able to import this file in your favorite BitTorrent client, just bencode\r\n`metainfo` to a _.torrent_ file and you're done:\r\n\r\n\r\n````clojure\r\n\r\n(bencode metainfo {:to file-out-stream})\r\n````\r\n\r\n\r\n## License\r\n\r\nCopyright (C) Daniel Fernandes Martins\r\n\r\nDistributed under the New BSD License. See COPYING for further details.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}